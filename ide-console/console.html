<!DOCTYPE HTML>
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
		<meta charset="utf-8" />
		<title>Eclipse Dirigible Log Console</title>
	</head>
	<body style="background-color: black; color: #44EE44; font-family: monospace;" onload="connectToLog()">
		<script>
		var connectToLog = function() {
			try {
				var logSocket = new WebSocket(((location.protocol === 'https:') ? "wss://" : "ws://") 
						+ window.location.host + "/websockets/v3/ide/console");
			} catch(e) {
				document.writeln("<div style='background-color: black; font-family: monospace; color: red'>[" + new Date().toISOString() + "][error]" + e.message + "</div>");
				
			}
			logSocket.onmessage = function (message) {
				var record = JSON.parse(message.data);
				var color = "#44EE44";
				
				if (record.level === 'ERROR') color = "red";
				else if (record.level === 'DEBUG') color = "silver";
				else if (record.level === 'WARN') color = "yellow";
				else if (record.level === 'TRACE') color = "white";
				
				var date = new Date(record.timestamp);
				var id = record.timestamp;
				document.writeln("<div id='" + id + "' style='background-color: black; font-family: monospace; color: " + color + "'>[" + date.toISOString() + "]" + " [" + record.level + "] " + record.message + "</div>");
				window.location.hash = "#" + id;
				document.body.style.backgroundColor = "black";
			};
			
			setInterval(clear, 6000000);
		}
		var clear = function() {
			document.body.innerHTML = '';
			document.writeln("<div style='background-color: black; font-family: monospace; color: gray'>[" + new Date().toISOString() + "][cleared]...</div>");
			document.body.style.backgroundColor = "black";
		}
		</script>
	</body>
</html>
