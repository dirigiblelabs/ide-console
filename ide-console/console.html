<!DOCTYPE HTML>
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
		<meta charset="utf-8" />
		<title>Eclipse Dirigible Log Console</title>
	</head>
	<body style="background-color: black; color: #44EE44; font-family: monospace;" onload="connectToLog()">
		<script>
		function connectToLog() {
			try {
				var logSocket = new WebSocket(((location.protocol === 'https:') ? "wss://" : "ws://") 
						+ window.location.host + "/websockets/v3/ide/console");
			} catch(e) {
				append("-1", "[" + new Date().toISOString() + "] [ERROR]" + e.message, "background-color: black; font-family: monospace; color: red");
			}
			logSocket.onmessage = function (message) {
				var record = JSON.parse(message.data);
				var color = "#44EE44";
				
				if (record.level === 'ERROR') color = "red";
				else if (record.level === 'DEBUG') color = "silver";
				else if (record.level === 'WARN') color = "yellow";
				else if (record.level === 'TRACE') color = "white";
				
				var date = new Date(record.timestamp);
				var id = record.timestamp;
				append(id, "[" + date.toISOString() + "] [" + record.level + "] " + record.message, "background-color: black; font-family: monospace; color: " + color);
				window.location.hash = "#" + id;
			};
			
			setInterval(clear, 6000000);
		}
		
		function clear() {
			document.body.innerHTML = '';
			append("0", "[" + new Date().toISOString() + "]...", "background-color: black; font-family: monospace; color: gray");
		}
		
		function append(id, content, style) {
			var div = document.createElement('div');
            div.id = id;
			div.textContent = content;
            div.style.cssText = style;
			document.body.appendChild(div);
		}
		
		</script>
	</body>
</html>
